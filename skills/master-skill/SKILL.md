---
name: master-skill
description: >
  Orchestrates new AI/CV project initialization using the whet framework.
  Guides archetype selection, skill composition, directory scaffolding, and initial
  configuration for new computer vision and deep learning projects.
---

# Master Skill: Project Initialization

You are initializing a new AI/CV project using the whet framework.

## Initialization Process

1. **Ask the user for project details:**
   - Project name (e.g., "Face Detection System")
   - Project slug (auto-generate from name: "face-detection-system")
   - Package name (auto-generate: "face_detection_system")
   - Author name
   - Email
   - Description
   - Python version (default: 3.11)
   - Initial version (default: 0.1.0)

2. **Ask which archetype to use:**
   - pytorch-training-project
   - cv-inference-service
   - research-notebook
   - library-package
   - data-processing-pipeline
   - model-zoo

3. **Ask which optional skills to include:**
   - Weights & Biases (wandb)
   - MLflow
   - TensorBoard
   - DVC (data versioning)
   - ONNX export

4. **Generate project using selected archetype**
   - Copy archetype directory structure
   - Substitute templated values (project_name, author, etc.)
   - Include only requested optional skills
   - Generate appropriate pixi.toml with dependencies

5. **Verify structure and files**
   - Ensure all required files present
   - Run initial linting checks
   - Initialize git repository

## Standard Directory Structure (All Archetypes Share)

Every project generated by the master skill shares a common directory layout. Archetypes extend this base with additional directories specific to their purpose (e.g., `configs/`, `notebooks/`, `docker/`).

```
{{project_slug}}/
├── .github/workflows/
│   ├── code-review.yml        # Code Review Agent
│   └── test.yml               # Test Engineer Agent
├── .gitignore
├── .pre-commit-config.yaml
├── pixi.toml
├── pyproject.toml
├── README.md
├── src/{{package_name}}/
│   ├── __init__.py
│   └── py.typed               # PEP 561 marker
└── tests/
    ├── __init__.py
    └── conftest.py
```

### Why src-layout?

The `src/` layout is mandatory across all archetypes. It prevents accidental imports of the local package during testing and enforces proper installation. The `py.typed` marker enables downstream consumers to benefit from your type annotations.

```python
# src/{{package_name}}/__init__.py
"""{{description}}."""

__version__ = "{{version}}"
```

```python
# tests/conftest.py
"""Shared test fixtures for {{project_name}}."""

from __future__ import annotations

import pytest


@pytest.fixture
def sample_data_dir(tmp_path):
    """Provide a temporary directory pre-populated with test data."""
    data_dir = tmp_path / "data"
    data_dir.mkdir()
    return data_dir
```

## Configuration Standards

### pyproject.toml (Always Include)

This is the single source of truth for project metadata and tool configuration. Every archetype includes this file with ruff, mypy, and pytest fully configured.

```toml
[project]
name = "{{project_slug}}"
version = "{{version}}"
description = "{{description}}"
authors = [{name = "{{author_name}}", email = "{{email}}"}]
requires-python = ">=3.11"

[tool.ruff]
line-length = 100
target-version = "py311"

[tool.ruff.lint]
select = ["E", "F", "I", "N", "UP", "S", "B", "A", "C4", "T20", "SIM"]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = ["S101"]

[tool.ruff.lint.isort]
known-first-party = ["{{package_name}}"]

[tool.mypy]
python_version = "3.11"
strict = true
disallow_any_explicit = true
warn_return_any = true
ignore_missing_imports = false

[[tool.mypy.overrides]]
module = ["cv2.*", "albumentations.*"]
ignore_missing_imports = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = "--cov=src --cov-report=term --cov-report=xml --cov-fail-under=80"
```

### Ruff Rule Categories Explained

| Rule | Purpose |
|------|---------|
| `E` | pycodestyle errors |
| `F` | pyflakes (unused imports, variables) |
| `I` | isort (import ordering) |
| `N` | pep8-naming conventions |
| `UP` | pyupgrade (modern Python syntax) |
| `S` | bandit (security checks) |
| `B` | bugbear (common bugs) |
| `A` | builtins shadowing |
| `C4` | flake8-comprehensions |
| `T20` | flake8-print (no print statements) |
| `SIM` | flake8-simplify |

### .pre-commit-config.yaml (Always Include)

Pre-commit hooks run automatically before every commit to enforce code quality standards. This configuration is non-negotiable for all archetypes.

```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.11.2
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

### pixi.toml (Always Include)

Pixi manages the project environment including conda and PyPI dependencies. This replaces requirements.txt, environment.yml, and Makefiles.

```toml
[project]
name = "{{project_slug}}"
version = "{{version}}"
description = "{{description}}"
authors = ["{{author_name}} <{{email}}>"]
channels = ["conda-forge", "pytorch"]
platforms = ["linux-64", "osx-64", "osx-arm64"]

[dependencies]
python = ">=3.11"
loguru = ">=0.7"

[feature.dev.dependencies]
pytest = ">=7.4"
pytest-cov = ">=4.1"
ruff = ">=0.8"
mypy = ">=1.11"
pre-commit = ">=3.5"

[tasks]
test = "pytest tests/ -v"
test-cov = "pytest tests/ --cov=src --cov-report=term --cov-report=html --cov-fail-under=80"
lint = "ruff check ."
format = "ruff format ."
typecheck = "mypy src/ --strict"
```

## Logging Convention

All projects use **loguru** for logging. Never use `print()` or `logging.getLogger()`.

```python
# ✅ Correct — every module
from loguru import logger

logger.info("Training started")
logger.debug("Batch shape: {}", batch.shape)

# ❌ Wrong — never use these
print("Training started")            # No print
import logging                        # No stdlib logging
log = logging.getLogger(__name__)     # No getLogger
```

Every project includes a `setup_logging()` function. Call it **once** at the entry point, never in library modules.

```python
# src/{{package_name}}/log.py
import sys
from loguru import logger


def setup_logging(level: str = "INFO", log_file: str | None = None) -> None:
    """Configure loguru. Call once in main(), train.py, or serve.py."""
    logger.remove()
    logger.add(sys.stderr, level=level, colorize=True)
    if log_file:
        logger.add(log_file, rotation="100 MB", retention="7 days", compression="gz")
```

See the **Loguru** skill for structured context binding, InterceptHandler for third-party libraries, JSON serialization, and Pydantic configuration.

### .gitignore (Always Include)

```gitignore
# Python
__pycache__/
*.py[cod]
*.egg-info/
dist/
build/
.eggs/

# Environments
.pixi/
.venv/
*.lock

# IDE
.vscode/
.idea/

# Testing
.coverage
htmlcov/
.pytest_cache/

# ML artifacts
*.pt
*.pth
*.onnx
*.safetensors
wandb/
mlruns/
lightning_logs/

# Data
data/raw/
data/processed/
*.hdf5
*.h5
```

## Template Variables

These variables are substituted throughout all generated files during project initialization. The master skill replaces every occurrence of `{{variable}}` with the user-provided value.

| Variable | Description | Example |
|----------|-------------|---------|
| `{{project_name}}` | Human-readable name | Face Detection System |
| `{{project_slug}}` | URL/directory safe | face-detection-system |
| `{{package_name}}` | Python import name | face_detection_system |
| `{{author_name}}` | Author full name | Enrique G. Ortiz |
| `{{email}}` | Author email | ortizeg@gmail.com |
| `{{description}}` | Project description | A face detection system |
| `{{version}}` | Initial version | 0.1.0 |
| `{{python_version}}` | Python version | 3.11 |

### Variable Derivation Rules

```python
# project_slug is derived from project_name
project_slug = project_name.lower().replace(" ", "-").replace("_", "-")
# Example: "Face Detection System" -> "face-detection-system"

# package_name is derived from project_slug
package_name = project_slug.replace("-", "_")
# Example: "face-detection-system" -> "face_detection_system"
```

## Archetype-Specific Extensions

Each archetype adds directories and files on top of the standard structure. Here is what each archetype adds:

### pytorch-training-project

```
configs/
├── experiment/
│   └── default.yaml
├── model/
│   └── default.yaml
└── data/
    └── default.yaml
src/{{package_name}}/
├── models/
│   └── __init__.py
├── data/
│   └── __init__.py
├── transforms/
│   └── __init__.py
└── train.py
scripts/
└── train.sh
```

### cv-inference-service

```
src/{{package_name}}/
├── api/
│   ├── __init__.py
│   └── routes.py
├── models/
│   └── __init__.py
└── inference/
    └── __init__.py
docker/
├── Dockerfile
└── docker-compose.yml
```

### research-notebook

```
notebooks/
├── 01_exploration.ipynb
└── 02_experiments.ipynb
data/
├── raw/.gitkeep
└── processed/.gitkeep
```

## Post-Initialization Checklist

After generating the project, the master skill verifies each of these items:

- [ ] All template variables replaced (no `{{` remaining in any file)
- [ ] `pixi install` succeeds
- [ ] `pixi run lint` passes
- [ ] `pixi run typecheck` passes
- [ ] `pixi run test` passes (placeholder tests)
- [ ] `.git` initialized
- [ ] Pre-commit hooks installed
- [ ] README.md populated with project details

### Verification Script

```bash
# Run after project generation to verify everything works
cd {{project_slug}}

# Check no template variables remain
grep -r '{{' . --include='*.py' --include='*.toml' --include='*.yaml' --include='*.md' && echo "FAIL: Template variables remain" || echo "PASS: All variables substituted"

# Install and verify
pixi install
pixi run lint
pixi run typecheck
pixi run test

# Initialize git
git init
pixi run pre-commit install
git add .
git commit -m "Initial project from {{archetype}} archetype"
```

## Error Handling

If any step fails during initialization:

1. **Missing user input**: Re-prompt with sensible defaults
2. **Invalid archetype**: Show list of valid archetypes and ask again
3. **Template substitution failure**: Report which files still contain `{{` markers
4. **Pixi install failure**: Check pixi.toml channels and dependency compatibility
5. **Lint/typecheck failure**: Fix generated code before completing initialization

The master skill never leaves the project in a broken state. If initialization cannot be completed cleanly, it reports exactly what went wrong and what manual steps are needed.
